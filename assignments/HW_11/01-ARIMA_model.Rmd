# (10 points) ARIMA model

Consider `fma::sheep`, the sheep population of England and Wales from 1867--1939. :sheep: 

```{r load sheep data, message=FALSE, warning=FALSE}
#install.packages('fma')
library(fma)
library(fpp3)
head(fma::sheep)
```

## Time series plot
Produce a time plot of the time series, and comment on what you observe.

```{r produce a time series plot of sheep}
plot(fma::sheep)
```

From the time series plot we can observe some piecewise trends, where the population from 1870 to the early 1920s was clearly declining as a whole, with a a lot of variation in the individual years, and it started to climb back up again from ~1922.

## Fit a model 

Assume you decide to fit the following model: 

$$
y_{t} = y_{t-1} + \phi_1(y_{t-1}-y_{t-2}) + \phi_2(y_{t-2}-y_{t-3}) + \phi_3(y_{t-3}-y_{t-4}) + \epsilon_t
$$ 
where $\epsilon_t$ is a white noise series.

### Model type

What sort of ARIMA model is this (i.e., what are $p$, $d$, and $q$)?

> This is an ARIMA(3,1,0) model.

### Back to the future 

Express this ARIMA model using backshift operator notation.

$$
y_t (1-B)(1-\phi_1B + \phi_2 B^2 + \phi_3 B^3) = \varepsilon_t
$$
Where $(1-B)$ represents the first differencing, and the multiplied polynomial is the AR(3) portion, with no MA portion.


## Is this model appropriate? 

Examine the ACF and PACF of the differenced data. Evaluate whether this model is appropriate. 

```{r}
sheep <- as_tsibble(fma::sheep)
sheep %>% gg_tsdisplay(difference(value), plot_type="partial")
```

> From the ACF plot, we can see a dampened sine wave pattern (with an uncharacteristic spike at lag 17 or 18). We further notice that the PACF plot has significant spikes at lags 1, 2, and 3, but not for any of the subsequent lags (except for one uncharacteristic spike at lag 19). These patterns are characteristic of AR(3) models, which provides evidence that this is a good model for the data. We do , however, underscore the uncharacteristic aforementioned spikes which might be an indication that there's an underlying signal that is not being adequately captured, so a more robust model might be chosen.

## Forecasts, by hand! 

The last five values of the series are given below:

| Year              | 1935 | 1936 | 1937 | 1938 | 1939 |
|:------------------|-----:|-----:|-----:|-----:|-----:|
| Millions of sheep | 1648 | 1665 | 1627 | 1791 | 1797 |

The estimated parameters are: 

- $\phi_1 =  0.42$; 
- $\phi_2 = -0.20$;  and, 
- $\phi_3 = -0.30$.

Without using the forecast function, calculate forecasts for the next three years (1940--1942).

```{r create forcasts by hand}
## you can use R as a calculator here
phi_1 =  0.42
phi_2 = -0.20
phi_3 = -0.30
y.val <- function(h, base.data) {
	for(i in 1:h) {
		df <- slice_tail(base.data, n = 4)
		df <- as.ts(df)
		result <- nth(df, -1) + sum(phi_1*c(nth(df, -1), -nth(df, -2))) +  sum(phi_2*c(nth(df, -2), -nth(df, -3))) + sum(phi_3*c(nth(df, -3), -nth(df, -4)))
		base.data <- bind_rows(base.data, data.frame(index=(slice_tail(base.data, n=1)$index)+1, value=result))
	}
	return(slice_tail(base.data, n=h))
}
```

```{r}
y.val(3, sheep)
```


## Interpret roots
Find the roots of your model's characteristic equation. Is this process stationary?.

```{r}
abs(polyroot(c(1, -phi_1, phi_2, phi_3)))
```

The absolute value of the roots of the 3rd order polynomial are above, and the other root is $B = 1$. Because this is a unit root, this process is _not stationary_.

